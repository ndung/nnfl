<div th:fragment="generalInfoCard" class="kt-card kt-card-grid h-full min-w-full">
    <div class="kt-card-header flex justify-between">
        <h3 class="kt-card-title">General information</h3>
        <button type="button" id="addGeneralInfo" class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost"><i class="ki-filled ki-additem"></i></button>
    </div>
    <div class="kt-card-table">
        <div class="grid">
            <div class="kt-scrollable-x-auto">
                <table id="generalInfoTable" class="kt-table kt-table-border table-fixed text-[10px]" data-kt-datatable-table="true">
                    <thead>
                    <tr>
                        <th style="width:0%"><span class="kt-table-col"><span class="kt-table-col-label" hidden>ID</span></span></th>
                        <th style="width:7%"><span class="kt-table-col"><span class="kt-table-col-label">Stage</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Record Date</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Custodian</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Analytical Lab</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Analysis Date</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Country</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Producer</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Supplier</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Batch ID</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Batch Process</span></span></th>
                        <th style="width:5%"><span class="kt-table-col"><span class="kt-table-col-label">Shipper/Carrier</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Receiver Info</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Shipping Date</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Receiving Date</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Data Eval Info</span></span></th>
                        <th style="width:5%"><span class="kt-table-col"><span class="kt-table-col-label">Variation Range</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Acquisition</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Used Archived</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Notes</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Image/PDF</span></span></th>
                        <th><span class="kt-table-col"><span class="kt-table-col-label">Action</span></span></th>
                    </tr>
                    </thead>
                    <tbody th:each="info : ${material.generalInfo}">
                    <tr>
                        <td><span th:text="${info.id}" hidden></span></td>
                        <td><span th:text="${info.stage}"></span></td>
                        <td><span th:text="${#dates.format(info.dataRecordDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${info.custodian}"></span></td>
                        <td><span th:text="${info.analyticalLab}"></span></td>
                        <td><span th:text="${#dates.format(info.analysisDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${info.countryOfOrigin}"></span></td>
                        <td><span th:text="${info.producer}"></span></td>
                        <td><span th:text="${info.supplier}"></span></td>
                        <td><span th:text="${info.batchId}"></span></td>
                        <td><span th:text="${#dates.format(info.batchProcessDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${info.shipperCarrier}"></span></td>
                        <td><span th:text="${info.receiverInfo}"></span></td>
                        <td><span th:text="${#dates.format(info.shippingDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${#dates.format(info.receivingDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${info.dataEvaluationInfo}"></span></td>
                        <td><span th:text="${info.variationRangeNotes}"></span></td>
                        <td><span th:text="${#dates.format(info.informationAcquisitionDate, 'yyyy-MM-dd')}"></span></td>
                        <td><span th:text="${info.usedArchivedInformation}"></span></td>
                        <td><span th:text="${info.notes}"></span></td>
                        <td>
                            <span hidden th:text="${info.imageFile}"></span>
                            <a th:if="${info.imageFile}" th:href="${info.fileUrl}" target="_blank" rel="noopener noreferrer"
                               class="kt-link" aria-label="View attachment">
                                <i class="ki-filled ki-eye"></i>
                            </a>
                        </td>
                        <td class="flex gap-2">
                            <th:block th:if="${info.stage == T(io.sci.nnfl.model.Stage).values()[stage]}">
                                <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost editRow">
                                    <i class="ki-filled ki-notepad-edit"></i>
                                </button>
                                <form th:action="@{|/general-info/${material.id}/${stage}/${info.id}/delete|}" method="post" onsubmit="return confirm('Delete?');">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <button class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost"><i class="ki-filled ki-trash"></i></button>
                                </form>
                            </th:block>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

