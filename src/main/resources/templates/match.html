<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body}, 'index')}">
<body>
<div class="kt-container-fluid">
    <div class="grid gap-5 lg:gap-7.5 xl:w-[45rem] mx-auto">
        <div class="kt-card">
            <div class="kt-card-header">
                <h3 class="kt-card-title">Match</h3>
            </div>
            <div class="kt-card-content grid gap-5">
                <form id="matchForm"
                      class="flex flex-col lg:flex-row gap-3 lg:gap-4 items-stretch"
                      th:action="@{/match}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <label class="sr-only" for="matchQuery">Match prompt</label>
                    <input id="matchQuery"
                           type="text"
                           name="q"
                           class="kt-input grow"
                           placeholder="Enter a material id to match"
                           th:value="${query}"/>
                    <button id="matchSubmit" class="kt-btn kt-btn-primary lg:w-auto" type="submit">
                        Match
                    </button>
                </form>
                <div id="matchLoading" class="hidden items-center gap-2 text-sm text-muted-foreground" role="status" aria-live="polite">
                    <span class="h-4 w-4 rounded-full border-2 border-muted-foreground border-t-transparent animate-spin"></span>
                    <span>Matchingâ€¦</span>
                </div>
                <div id="matchResults" class="grid gap-4">
                    <div th:if="${!hasQuery}">
                        <p class="text-sm text-muted-foreground">
                            Enter a material id above and click <strong>Match</strong> to see the results here.
                        </p>
                    </div>
                    <div th:if="${hasQuery}" class="grid gap-3">
                        <p class="text-sm text-muted-foreground" th:if="${!hasRecord}">
                            No material record found for
                            <span class="font-medium" th:text="${query}">your query</span>.
                        </p>
                        <p class="text-sm text-muted-foreground" th:if="${hasRecord and #lists.isEmpty(results)}">
                            No matching results found for
                            <span class="font-medium" th:text="${query}">your query</span>.
                        </p>
                        <ul th:if="${!#lists.isEmpty(results)}" class="grid gap-3 text-xs">
                            <li class="kt-card kt-card-bordered p-4" th:each="result : ${results}">
                                <div class="flex flex-col gap-2">
                                    <div class="flex items-start justify-between gap-3">
                                        <span class="font-medium" th:text="${result.record.id}">Material title</span>
                                        <span class="text-xs font-medium text-muted-foreground" th:text="${result.scoreDisplay}">0.000</span>
                                    </div>
                                    <p class="text-xs text-muted-foreground" th:text="${result.record.data}">Summary</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('matchForm');
        const spinner = document.getElementById('matchLoading');
        const submitButton = document.getElementById('matchSubmit');

        if (!form || !spinner) {
            return;
        }

        form.addEventListener('submit', function () {
            spinner.classList.remove('hidden');
            spinner.classList.add('flex');
            if (submitButton) {
                submitButton.setAttribute('disabled', 'disabled');
            }
        });
    });
</script>
</body>
</html>
