<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout (~{::body}, 'index')}">
<body>
<div class="kt-container-fluid">
    <div class="grid gap-5 lg:gap-7.5 xl:w-[45rem] mx-auto">
        <div class="kt-card">
            <div class="kt-card-header">
                <h3 class="kt-card-title">Search</h3>
            </div>
            <div class="kt-card-content grid gap-5">
                <form class="flex flex-col lg:flex-row gap-3 lg:gap-4 items-stretch"
                      th:action="@{/search}" method="get">
                    <label class="sr-only" for="searchQuery">Search prompt</label>
                    <input id="searchQuery"
                           type="text"
                           name="q"
                           class="kt-input grow"
                           placeholder="Enter a prompt to search"
                           th:value="${query}"/>
                    <label class="sr-only" for="searchVersion">Search version</label>
                    <select id="searchVersion"
                            name="version"
                            class="kt-input lg:w-44"
                            aria-label="Search version">
                        <option value="1" th:selected="${version == '1'}">Version 1 (MQL)</option>
                        <option value="2"
                                th:selected="${version == '2'}"
                                th:disabled="${!searchEnabled}">
                            Version 2 (Natural language)
                        </option>
                    </select>
                    <button class="kt-btn kt-btn-primary lg:w-auto" type="submit">
                        Search
                    </button>
                </form>
                <div id="searchResults" class="grid gap-4">
                    <div th:if="${!hasQuery}">
                        <p class="text-sm text-muted-foreground">
                            Enter a prompt above and click <strong>Search</strong> to see the results here.
                        </p>
                    </div>
                    <div th:if="${hasQuery}" class="grid gap-3">
                        <p class="text-sm text-muted-foreground" th:if="${usingNaturalLanguage and !searchEnabled}">
                            Natural language search is currently unavailable because the OpenAI client is not configured.
                        </p>
                        <p class="text-sm text-muted-foreground" th:if="${searchAttempted and #lists.isEmpty(results)}">
                            No results found for
                            <span class="font-medium" th:text="${query}">your query</span>.
                        </p>
                        <ul th:if="${searchAttempted and !#lists.isEmpty(results)}" class="grid gap-3">
                            <li class="kt-card kt-card-bordered p-4" th:each="result : ${results}">
                                <span class="text-sm" th:text="${result}">Search result</span>
                            </li>
                        </ul>
                        <div th:if="${showConfigWarning}" class="rounded-md border border-dashed border-destructive/40 bg-destructive/10 p-3 text-sm text-destructive">
                            Material search is not configured. Provide OpenAI credentials to enable semantic search.
                        </div>
                        <div th:if="${searchConfigured}" class="grid gap-3">
                            <p class="text-sm text-muted-foreground" th:if="${#lists.isEmpty(results)}">
                                No results found for
                                <span class="font-medium" th:text="${query}">your query</span>.
                            </p>
                            <ul th:if="${!#lists.isEmpty(results)}" class="grid gap-3">
                                <li class="kt-card kt-card-bordered p-4" th:each="result : ${results}">
                                    <div class="flex flex-col gap-2">
                                        <div class="flex items-start justify-between gap-3">
                                            <span class="font-medium" th:text="${result.title}">Material title</span>
                                            <span class="text-xs font-medium text-muted-foreground" th:text="${result.scoreDisplay}">0.000</span>
                                        </div>
                                        <p th:if="${result.hasSnippet()}" class="text-sm text-muted-foreground" th:text="${result.snippet}">Summary</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
